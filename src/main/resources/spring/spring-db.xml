<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:jdbc="http://www.springframework.org/schema/jdbc" xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:jpa="http://www.springframework.org/schema/data/jpa" xmlns:jee="http://www.springframework.org/schema/jee"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc.xsd
       http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd
       http://www.springframework.org/schema/data/jpa http://www.springframework.org/schema/data/jpa/spring-jpa.xsd
       http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee.xsd">

	<context:property-placeholder location="classpath:db/postgres.properties"
		system-properties-mode="OVERRIDE" />

<!-- 	<context:property-placeholder location="classpath:db/hsqldb.properties"
		system-properties-mode="OVERRIDE" /> -->


	<jdbc:initialize-database data-source="dataSource"
		enabled="${database.init}">
		<jdbc:script location="classpath:db/${jdbc.initLocation}" />
		<jdbc:script location="classpath:db/populateDB.sql" />
	</jdbc:initialize-database>

	<tx:annotation-driven />

	<bean id="transactionManager" class="org.springframework.orm.jpa.JpaTransactionManager"
		p:entityManagerFactory-ref="entityManagerFactory" />


	<context:component-scan
		base-package="org.andsav.family_budget_manager.**.repository.jpa" />

	<bean id="entityManagerFactory"
		class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"
		p:dataSource-ref="dataSource" p:packagesToScan="org.andsav.family_budget_manager.**.model">

		<property name="jpaPropertyMap">
			<map>
				<entry key="#{T(org.hibernate.cfg.AvailableSettings).FORMAT_SQL}"
					value="${hibernate.format_sql}" />
				<entry key="#{T(org.hibernate.cfg.AvailableSettings).USE_SQL_COMMENTS}"
					value="${hibernate.use_sql_comments}" />
				<!--<entry key="#{T(org.hibernate.cfg.AvailableSettings).HBM2DDL_AUTO}" 
					value="${hibernate.hbm2ddl.auto}"/> -->

				<!-- <entry key="#{T(org.hibernate.cfg.AvailableSettings).CACHE_REGION_FACTORY}" 
					value="org.hibernate.cache.ehcache.SingletonEhCacheRegionFactory" /> <entry 
					key="#{T(org.hibernate.cfg.AvailableSettings).USE_SECOND_LEVEL_CACHE}" value="true" 
					/> <entry key="#{T(org.hibernate.cfg.AvailableSettings).USE_QUERY_CACHE}" 
					value="false" /> default <entry key="#{T(org.hibernate.cache.ehcache.AbstractEhcacheRegionFactory).NET_SF_EHCACHE_CONFIGURATION_RESOURCE_NAME}" 
					value="cache/ehcache.xml" /> -->

			</map>
		</property>

		<property name="jpaVendorAdapter">
			<bean class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter"
				p:showSql="${jpa.showSql}" p:databasePlatform="org.hibernate.dialect.PostgreSQL9Dialect" />
		</property>
	</bean>

	<!-- no pooling -->
	<bean id="dataSource"
		class="org.springframework.jdbc.datasource.DriverManagerDataSource">
		<property name="driverClassName" value="${database.driverClassName}" />
		<property name="url" value="${database.url}" />
		<property name="username" value="${database.username}" />
		<property name="password" value="${database.password}" />
	</bean>

	<!-- <context:component-scan base-package="org.andsav.family_budget_manager.**.repository.jdbc" 
		/> <bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate"> 
		<constructor-arg ref="dataSource" /> </bean> <bean id="namedJdbcTemplate" 
		class="org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate"> 
		<constructor-arg ref="dataSource" /> </bean> -->
</beans>